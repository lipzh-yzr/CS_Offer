

![](https://z3.ax1x.com/2021/07/31/Wvp8JK.png)

# 总结

通常，我们在解决一个系统问题的时候，会引入一个新机制，或者设计一层新功能，就像 我们在这两节课学习的内容：为了实现主从切换，我们引入了哨兵；为了避免单个哨兵故 障后无法进行主从切换，以及为了减少误判率，又引入了哨兵集群；哨兵集群又需要有一 些机制来支撑它的正常运行。

支持哨兵集群的这些关键机制，包括：

- 基于 pub/sub 机制的哨兵集群组成过程； 
- 基于 INFO 命令的从库列表，这可以帮助哨兵和从库建立连接； 
- 基于哨兵自身的 pub/sub 功能，这实现了客户端和哨兵之间的事件通知。

对于主从切换，当然不是哪个哨兵想执行就可以执行的，否则就乱套了。所以，这就需要 哨兵集群在判断了主库“客观下线”后，经过投票仲裁，选举一个 Leader 出来，由它负责 实际的主从切换，即由它来完成新主库的选择以及通知从库与客户端。

最后，就是要注意：**要保证所有哨兵实例的配置是一致的，尤其是主观下线 的判断值 down-after-milliseconds。**